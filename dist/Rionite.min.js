!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("cellx")):"function"==typeof define&&define.amd?define(["cellx"],e):t.Rionite=t.rionite=e(t.cellx)}(this,function(t){"use strict";function e(t,e,n,i){var r=void 0;D.call(U,t)&&D.call(U[t],e)?(r=U[t][e],n&&(r=r[W(i[0])])):r=e;for(var o=Object.create(null),s=i.length;s;)o[s]=i[--s];n&&(o.n=i[0]);var a=[];r=r.split(P);for(var l=0,c=r.length;l<c;)l%3?(a.push(r[l+1]?r[l+1].split("|")[W(o[r[l]])]:o[r[l]]),l+=2):(a.push(r[l]),l++);return a.join("")}function n(t){U=t.texts,W=Function("n","return "+t.localeSettings.plural+";"),e.localeSettings=t.localeSettings}function i(t){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return e("",t,!1,i)}function r(t,n){for(var i=arguments.length,r=Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];return e(n,t,!1,r)}function o(t){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return e("",t,!0,i)}function s(t,n){for(var i=arguments.length,r=Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];return e(n,t,!0,r)}function a(t){return V.test(t)?t.replace(V,function(t){return q[t]}):t}function l(t){return z.test(t)?t.replace(z,function(t){return K[t]}):t}function c(t){return"[object RegExp]"==$.call(t)}function h(t){return Q[t]||(Q[t]=t.replace(Z,function(t,e){return e.toUpperCase()}))}function u(t){return nt[t]||(nt[t]=t.replace(Y,function(t,e,n){return"-"+e.toLowerCase()+n}).replace(tt,function(t,e){return"-"+e.toLowerCase()}).replace(et,""))}function d(t){return at.test(t)?t.replace(at,function(t){return lt[t]}):t}function f(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.parent=e;var n={js:[]},i=[n],r=this._blocks=Object.create(e?e._blocks:null);t=t.split(ht);for(var o=0,s=t.length;o<s;)if(o%6){var l=t[o];if(l)n.js.push("this."+l+".call(this, data)"),n=r[l]={name:l,js:[]},i.push(n);else if(t[o+1])i.length>1&&(i.pop(),n=i[i.length-1]);else if(t[o+2])e&&i.length>1&&e._blocks[n.name]&&n.js.push("_super.call(this, data)");else{var c=t[o+2];n.js.push(c?"escape(data."+c+")":"data."+t[o+3])}o+=5}else{var h=t[o];h&&n.js.push("'"+d(h)+"'"),o++}Object.keys(r).forEach(function(t){var n=e&&e._blocks[t],i=Function("_super","data","escape","return ["+r[t].js.join(", ")+"].join('');");r[t]=function(t){return i.call(this,n,t,a)}}),this._renderer=e?e._renderer:Function("data","escape","return ["+i[0].js.join(", ")+"].join('');")}function p(){var e=pt;pt=null;for(var n=0,i=e.length;n<i;n++){var r=e[n];try{r.callback.call(r.context)}catch(e){t.ErrorLogger.log(e)}}}function m(t,e){pt?pt.push({callback:t,context:e}):(pt=[{callback:t,context:e}],setTimeout(p,1))}function v(t){var e=t.elementIs;if(!e)throw new TypeError('Static property "elementIs" is required');if(D.call(t,"props")){var n=t.props;if(n&&(n.content||n.context))throw new TypeError('No need to declare property "'+(n.content?"content":"context")+'"');t.elementAttributes=n}var i=Object.getPrototypeOf(t.prototype).constructor;t.template!==i.template&&t.template&&_t.apply(t._markupBlockNames=[e],i._markupBlockNames||[]),t._assetClassNames=Object.create(i._assetClassNames||null);var r=t.elementExtends,o=r?ft[r]||window["HTML"+(r.charAt(0).toUpperCase()+r.slice(1))+"Element"]:HTMLElement,s=function(t){return o.call(this,t)},a=s.prototype=Object.create(o.prototype);return Object.defineProperty(s,"observedAttributes",{configurable:!0,enumerable:!0,get:function(){var e=t.elementAttributes;return e?Object.keys(e).map(function(t){return u(t)}):[]}}),wt(a,gt),Object.defineProperty(a,"constructor",{configurable:!0,writable:!0,value:s}),a._rioniteComponentConstructor=t,ft[e]=customElements.define(e,s,r?{extends:r}:null),t}function g(t,e){for(var n=e;t.classList.add(n.elementIs),n=Object.getPrototypeOf(n.prototype).constructor,n!=Ut;);}function b(t,e){var n=t.elementAttributes,i=e.elementAttributes;for(var r in i)if("function"!=typeof i[r]){var o=h(r);n[o]=n[o]}}function _(t){if(xt[t])return xt[t];t=t.split("?");var e=t.length;if(1==e)return xt[t]="this."+t[0];for(var n=t.length-2,i=Array(n);n;)i[--n]=" && (temp = temp"+t[n+1]+")";return xt[t]="(temp = this."+t[0]+")"+i.join("")+" && temp"+t[t.length-1]}function y(t,e){var n=e.arguments;return"(this['"+e.name+"'] || formatters['"+e.name+"']).call(this, "+t+(n&&n.value.length?", "+n.value.join(", "):"")+")"}function w(t){var e=t.raw;if(Lt[e])return Lt[e];var n=t.keypath.value.split("?"),i=n.length,r=t.formatters,o=!!r.length;if(1==i)return Lt[e]={value:o?r.reduce(y,"this."+n[0]):"this."+n[0],usesFormatters:o};for(var s=i-2,a=Array(s);s;)a[--s]=" && (temp = temp"+n[s+1]+")";return Lt[e]={value:"(temp = this."+n[0]+")"+a.join("")+" && "+(o?r.reduce(y,"temp"+n[i-1]):"temp"+n[i-1]),usesFormatters:o}}function C(t){var e=t.raw;if(Ot[e])return Ot[e];var n=w(t),i="var temp; return "+n.value+";";if(n.usesFormatters){var r=function(){var t=Function("formatters",i);return{v:Ot[e]=function(){return t.call(this,G)}}}();if("object"==typeof r)return r.v}return Ot[e]=Function(i)}function E(t,e){if(Ht[e])return Ht[e];if(1==t.length){var n=t[0];if(n.type==Ct.BINDING)return Ht[e]=C(n)}for(var i=!1,r=[],o=0,s=t.length;o<s;o++){var a=t[o];if(a.type==Ct.TEXT)r.push("'"+d(a.value)+"'");else{var l=w(a);!i&&l.usesFormatters&&(i=!0),r.push(l.value)}}if(r="var temp; return ["+r.join(", ")+"].join('');",i){var c=function(){var t=Function("formatters",r);return{v:Ht[e]=function(){return t.call(this,G)}}}();if("object"==typeof c)return c.v}return Ht[e]=Function(r)}function x(t,e,n){n===!1||null==n?t.removeAttribute(e):t.setAttribute(e,n===!0?"":n)}function T(e,n,i){function r(e){for(var a=function(e){switch(e.nodeType){case 1:for(var a=e.attributes,l=a.length;l;){var c=a.item(--l),h=c.value;if(kt.test(h)){var u=new It(h).parse();(u.length>1||u[0].type==Ct.BINDING)&&!function(){var n=c.name,r=new t.Cell(E(u,h),{owner:i,onChange:function(t){x(e,n,t.value)}});x(e,n,r.get()),(o||(o=[])).push(r)}()}}var d=e.$c;d&&(d.ownerComponent=n,d.props.context=i,(s||(s=[])).push(d)),!e.firstChild||d&&null!=d.constructor.template||r(e);break;case 3:var f=e.textContent;if(kt.test(f)){var p=new It(f).parse();if(p.length>1||p[0].type==Ct.BINDING){var m=new t.Cell(E(p,f),{owner:i,onChange:function(t){e.textContent=t.value}});e.textContent=m.get(),(o||(o=[])).push(m)}}}},l=e.firstChild;l;l=l.nextSibling)a(l)}i||(i=n);var o=null,s=null;return r(e),{bindings:o,childComponents:s}}function A(t){for(var e=0,n=t.length;e<n;e++){var i=t[e];i.isElementAttached||(i.isElementAttached=!0,i._attachElement())}}function M(t,e){for(var n in e){var i=void 0;if(":component"==n)i=t;else if(":element"==n)i=t.element;else if(i=t.$(n),!i)continue;var r=e[n];for(var o in r)t.listenTo(i,o,r[o])}}function N(t){var e=void 0,n=void 0,i=void 0;for(t instanceof Event?(e=t.target,n="rt-"+t.type):(e=t.target.element,n="rt-component-"+t.type);1==e.nodeType&&e.hasAttribute(n)&&(i||(i=[])).push(e),e=e.parentNode,e;){var r=e.$c;if(r&&i)for(var o=0,s=i.length;o<s;o++){var a=i[o],l=r[a.getAttribute(n)];if("function"==typeof l){if(l.call(r,t,a.$c||a)===!1)return void(t.isPropagationStopped=!0);if(t.isPropagationStopped)return}}}}function j(){}function S(){}function I(){}function L(){}function O(){}function H(){}function k(){}function B(){}var R=t.Utils.nextUID,F=t.EventEmitter.extend({constructor:function(){this._disposables={}},listenTo:function(t,e,n,i){var r=this,o=void 0;if(Array.isArray(t)||t instanceof NodeList||t instanceof HTMLCollection||t.addClass&&t.each){"object"!=typeof e||Array.isArray(e)?arguments.length<4&&(i=this):arguments.length<3&&(n=this),o=[];for(var s=0,a=t.length;s<a;s++)o.push(this.listenTo(t[s],e,n,i))}else if("object"==typeof e)if(o=[],Array.isArray(e)){arguments.length<4&&(i=this);for(var l=e,c=0,h=l.length;c<h;c++)o.push(this.listenTo(t,l[c],n,i))}else{i=arguments.length<3?this:n;var u=e;for(var d in u)o.push(this.listenTo(t,d,u[d],i))}else{if(arguments.length<4&&(i=this),"object"!=typeof n)return this._listenTo(t,e,n,i);var f=n;if(o=[],Array.isArray(f))for(var p=0,m=f.length;p<m;p++)o.push(this.listenTo(t,e,f[p],i));else for(var v in f)o.push(this.listenTo(t[v]("unwrap",0),e,f[v],i))}var g=R(),b=function(){for(var t=o.length;t;)o[--t].stop();delete r._disposables[g]},_=this._disposables[g]={stop:b,dispose:b};return _},_listenTo:function(e,n,i,r){var o=this;if(e instanceof t.EventEmitter)e.on(n,i,r);else{if(!e.addEventListener)throw new TypeError("Unable to add a listener");e!==r&&(i=i.bind(r)),e.addEventListener(n,i)}var s=R(),a=function(){o._disposables[s]&&(e instanceof t.EventEmitter?e.off(n,i,r):e.removeEventListener(n,i),delete o._disposables[s])},l=this._disposables[s]={stop:a,dispose:a};return l},setTimeout:function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){var n=this,i=R(),r=setTimeout(function(){delete n._disposables[i],t.call(n)},e),o=function(){n._disposables[i]&&(clearTimeout(r),delete n._disposables[i])},s=this._disposables[i]={clear:o,dispose:o};return s}),setInterval:function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){var n=this,i=R(),r=setInterval(function(){t.call(n)},e),o=function(){n._disposables[i]&&(clearInterval(r),delete n._disposables[i])},s=this._disposables[i]={clear:o,dispose:o};return s}),registerCallback:function(t){function e(){if(r._disposables[i])return delete r._disposables[i],t.apply(r,arguments)}var n=this,i=R(),r=this,o=function(){delete n._disposables[i]};return e.cancel=o,e.dispose=o,this._disposables[i]=e,e},dispose:function(){var t=this._disposables;for(var e in t)t[e].dispose();return this}}),D=Object.prototype.hasOwnProperty,$=Object.prototype.toString,P=/\{([1-9]\d*|n)(?::((?:[^|]*\|)+?[^}]*))?\}/,U=void 0,W=void 0;e.configure=n,e.t=i,e.pt=r,e.nt=o,e.npt=s,n({localeSettings:{code:"ru",plural:"(n%100) >= 5 && (n%100) <= 20 ? 2 : (n%10) == 1 ? 0 : (n%10) >= 2 && (n%10) <= 4 ? 1 : 2"},texts:{}});var G=Object.create(null);G.not=function(t){return!t},G.or=function(t,e){return t||e},G.default=function(t,e){return null==t?e:t},G.eq=function(t,e){return t==e},G.identical=function(t,e){return t===e},G.lt=function(t,e){return t<e},G.lte=function(t,e){return t<=e},G.gt=function(t,e){return t>e},G.gte=function(t,e){return t>=e},G.join=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:", ";return t.join(e)},G.t=e.t,G.pt=e.pt,G.nt=function(t,n){for(var i=arguments.length,r=Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];return r.unshift(t),e("",n,!0,r)},G.npt=function(t,n,i){for(var r=arguments.length,o=Array(r>3?r-3:0),s=3;s<r;s++)o[s-3]=arguments[s];return o.unshift(t),e(i,n,!0,o)},G.key=function t(e,t){return e&&e[t]},G.json=function(t){return JSON.stringify(t)};var V=/[&<>"]/g,q=Object.create(null);q["&"]="&amp;",q["<"]="&lt;",q[">"]="&gt;",q['"']="&quot;";var z=/&(?:amp|lt|gt|quot);/g,K=Object.create(null);K["&amp;"]="&",K["&lt;"]="<",K["&gt;"]=">",K["&quot;"]='"';var J=t.JS.Map,X=new J([[Boolean,[function(t){return null!==t&&"no"!=t},function(t){return t?"":null}]],["boolean",[function(t,e){return null!==t?"no"!=t:e},function(t,e){return t?"":e?"no":null}]],[Number,[function(t){return null!==t?+t:void 0},function(t){return void 0!==t?String(+t):null}]],["number",[function(t,e){return null!==t?+t:e},function(t){return void 0!==t?String(+t):null}]],[String,[function(t){return null!==t?t:void 0},function(t){return void 0!==t?String(t):null}]],["string",[function(t,e){return null!==t?t:e},function(t){return void 0!==t?String(t):null}]],[Object,[function(t){return null!==t?Object(Function("return "+l(t)+";")()):void 0},function(t){return null!=t?a(c(t)?t.toString():JSON.stringify(t)):null}]],["object",[function(t,e){return null!==t?Object(Function("return "+l(t)+";")()):e},function(t){return null!=t?a(c(t)?t.toString():JSON.stringify(t)):null}]]]),Z=/[-_]+([a-z]|$)/g,Q=Object.create(null),Y=/-?([A-Z])([^A-Z])/g,tt=/-?([A-Z]+)/g,et=/^-/,nt=Object.create(null),it=t.JS.Map,rt=new it([[Boolean,"boolean"],["boolean","boolean"],[Number,"number"],["number","number"],[String,"string"],["string","string"]]),ot=t.EventEmitter.extend({constructor:function(e){var n=this,i=e.$c,r=i.constructor.elementAttributes,o=function(o){var s=r[o],a=typeof s,l=void 0,c=void 0,d=void 0;if("function"==a)a=s,c=d=!1;else if("object"!=a||void 0===s.type&&void 0===s.default)l=s,c=d=!1;else{if(a=s.type,l=s.default,void 0===a)a=typeof l;else if(void 0!==l&&rt.get(a)!==typeof l)throw new TypeError("Specified type does not match type of defaultValue");c=s.required,d=s.readonly}var f=X.get(a);if(!f)throw new TypeError("Unsupported attribute type");var p=h(o),m=u(o);if(c&&!e.hasAttribute(m))throw new TypeError('Property "'+o+'" is required');var v=void 0;d?!function(){var t=f[0](e.getAttribute(m),l);v={configurable:!0,enumerable:!0,get:function(){return t},set:function(e){if(e!==t)throw new TypeError('Property "'+o+'" is readonly')}}}():!function(){var r=void 0,o=void 0,s=void 0,a=n["_"+p]=n["_"+m]=new t.Cell(e.getAttribute(m),{merge:function(t,e){return t!==e&&(r=o,o=f[0](t,l)),s=i.isReady,t},onChange:function(t){t.oldValue=r,t.value=o,s&&i.elementAttributeChanged(m,r,o)}});v={configurable:!0,enumerable:!0,get:function(){return a.get(),o},set:function(t){t=f[1](t,l),null===t?e.removeAttribute(m):e.setAttribute(m,t),a.set(t)}}}(),Object.defineProperty(n,p,v),m!=p&&Object.defineProperty(n,m,v)};for(var s in r)o(s)}}),st="[$_a-zA-Z][$\\w]*",at=/[\\'\r\n]/g,lt=Object.create(null);lt["\\"]="\\\\",lt["'"]="\\'",lt["\r"]="\\r",lt["\n"]="\\n";var ct="(?:"+st+"|\\[\\d+\\])(?:(?:\\."+st+"|\\[\\d+\\]))*",ht=RegExp("{{(?:\\s*(?:"+("block\\s+("+st+")|(\\/)block|(s)uper\\(\\)|("+ct+")")+(")\\s*|{\\s*("+ct+")\\s*}")+")}}");f.prototype.extend=function(t){return new f(t,this)},f.prototype.render=function(t){return this._renderer.call(this._blocks,t||{},a)};var ut,dt=t.Utils.mixin,ft=dt(Object.create(null),{a:window.HTMLAnchorElement,blockquote:window.HTMLQuoteElement,br:window.HTMLBRElement,caption:window.HTMLTableCaptionElement,col:window.HTMLTableColElement,colgroup:window.HTMLTableColElement,datalist:window.HTMLDataListElement,del:window.HTMLModElement,dir:window.HTMLDirectoryElement,dl:window.HTMLDListElement,document:window.HTMLDocument,element:Element,fieldset:window.HTMLFieldSetElement,frameset:window.HTMLFrameSetElement,h1:window.HTMLHeadingElement,h2:window.HTMLHeadingElement,h3:window.HTMLHeadingElement,h4:window.HTMLHeadingElement,h5:window.HTMLHeadingElement,h6:window.HTMLHeadingElement,hr:window.HTMLHRElement,iframe:window.HTMLIFrameElement,img:window.HTMLImageElement,ins:window.HTMLModElement,li:window.HTMLLIElement,menuitem:window.HTMLMenuItemElement,ol:window.HTMLOListElement,optgroup:window.HTMLOptGroupElement,p:window.HTMLParagraphElement,q:window.HTMLQuoteElement,tbody:window.HTMLTableSectionElement,td:window.HTMLTableCellElement,template:window.HTMLTemplateElement||HTMLElement,textarea:window.HTMLTextAreaElement,tfoot:window.HTMLTableSectionElement,th:window.HTMLTableCellElement,thead:window.HTMLTableSectionElement,tr:window.HTMLTableRowElement,ul:window.HTMLUListElement,vhgroupv:window.HTMLUnknownElement,vkeygen:window.HTMLUnknownElement}),pt=void 0,mt=t.JS.Symbol,vt=mt("Rionite.ElementProtoMixin.attached"),gt=(ut={rioniteComponent:null,get $c(){return new this._rioniteComponentConstructor(this)}},ut[vt]=!1,ut.connectedCallback=function(){this[vt]=!0;var t=this.rioniteComponent;t?t.isElementAttached?null===t._parentComponent&&(t._parentComponent=void 0,t.elementMoved()):(t._parentComponent=void 0,t.isElementAttached=!0,t._attachElement()):m(function(){if(this[vt]){var t=this.$c;t._parentComponent=void 0,t.parentComponent||(t.isElementAttached=!0,t._attachElement())}},this)},ut.disconnectedCallback=function(){this[vt]=!1;var t=this.rioniteComponent;t&&t.isElementAttached&&(t._parentComponent=null,m(function(){null===t._parentComponent&&t.isElementAttached&&(t.isElementAttached=!1,t._detachElement())}))},ut.attributeChangedCallback=function(t,e,n){var i=this.rioniteComponent;if(i&&i.isReady){var r=i.elementAttributes,o="_"+t;D.call(r,o)&&r[o].set(n)}},ut),bt=Array.prototype.slice,_t=Array.prototype.push,yt=Array.prototype.map,wt=t.Utils.mixin,Ct={TEXT:0,BINDING:1,BINDING_KEYPATH:2,BINDING_FORMATTER:3,BINDING_FORMATTER_ARGUMENTS:4},Et="(?:"+st+"|\\[\\d+\\])(?:\\??(?:\\."+st+"|\\[\\d+\\]))*",xt=Object.create(null),Tt=RegExp(st+"|","g"),At=RegExp(Et+"|","g"),Mt=/false|true|/g,Nt=/(?:[+-]\s*)?(?:0b[01]+|0[0-7]+|0x[0-9a-fA-F]+|(?:(?:0|[1-9]\d*)(?:\.\d+)?|\.\d+)(?:[eE][+-]?\d+)?|Infinity|NaN)|/g,jt=/null|undefined|void 0|/g,St={},It=t.Utils.createClass({constructor:function(t){this.content=t},parse:function(){this.at=0;for(var t,e=this.result=[];(t=this.content.indexOf("{",this.at))>-1;){this.pushText(this.content.slice(this.at,t)),this.at=t,this.chr=this.content.charAt(t);var n=this.readBinding();n?e.push(n):(this.pushText(this.chr),this.next("{"))}return this.pushText(this.content.slice(this.at)),e},pushText:function(t){if(t.length){var e=this.result,n=e.length;n&&e[n-1].type==Ct.TEXT?e[n-1].value=e[n-1].raw+=t:e.push({type:Ct.TEXT,at:this.at,raw:t,value:t})}},readBinding:function(){var t=this.at;this.next("{"),this.skipWhitespaces();var e=this.readBindingKeypath();if(e){for(var n,i=[];"|"==this.skipWhitespaces()&&(n=this.readFormatter());)i.push(n);if("}"==this.chr)return this.next(),{type:Ct.BINDING,at:t,raw:this.content.slice(t,this.at),keypath:e,formatters:i}}return this.at=t,this.chr=this.content.charAt(t),null},readBindingKeypath:function(){At.lastIndex=this.at;var t=At.exec(this.content)[0];if(t){var e=this.at;return this.chr=this.content.charAt(this.at+=t.length),{type:Ct.BINDING_KEYPATH,at:e,raw:this.content.slice(e,this.at),value:t}}return null},readFormatter:function(){var t=this.at;this.next("|"),this.skipWhitespaces(),Tt.lastIndex=this.at;var e=Tt.exec(this.content)[0];if(e){var n="("==(this.chr=this.content.charAt(this.at+=e.length))?this.readFormatterArguments():null;return{type:Ct.BINDING_FORMATTER,at:t,raw:this.content.slice(t,this.at),name:e,arguments:n}}return this.at=t,this.chr=this.content.charAt(t),null},readFormatterArguments:function(){var t=this.at,e=[];if(this.next("("),")"!=this.skipWhitespaces())for(;;){var n=this.readValueOrValueKeypath();if(n!==St&&(","==this.skipWhitespaces()||")"==this.chr)){if(e.push(n),","==this.chr){this.next(),this.skipWhitespaces();continue}break}return this.at=t,this.chr=this.content.charAt(t),null}return this.next(),{type:Ct.BINDING_FORMATTER_ARGUMENTS,at:t,raw:this.content.slice(t,this.at),value:e}},readValueOrValueKeypath:function(){var t=this.readValue();return t===St?this.readValueKeypath():t},readValue:function(){switch(this.chr){case"{":return this.readObject();case"[":return this.readArray();case"'":case'"':return this.readString()}for(var t=["readBoolean","readNumber","readVacuum"],e=0,n=t.length;e<n;e++){var i=this[t[e]]();if(i!==St)return i}return St},readObject:function(){var t=this.at;this.next("{");for(var e="{";"}"!=this.skipWhitespaces();){var n="'"==this.chr||'"'==this.chr?this.readString():this.readObjectKey();if(n!==St&&null!==n&&":"==this.skipWhitespaces()){this.next(),this.skipWhitespaces();var i=this.readValueOrValueKeypath();if(i!==St){if(","==this.skipWhitespaces()){e+=n+":"+i+",",this.next();continue}if("}"==this.chr){e+=n+":"+i+"}";break}}}return this.at=t,this.chr=this.content.charAt(t),St}return this.next(),e},readObjectKey:function(){Tt.lastIndex=this.at;var t=Tt.exec(this.content)[0];return t?(this.chr=this.content.charAt(this.at+=t.length),t):null},readArray:function(){var t=this.at;this.next("[");for(var e="[";"]"!=this.skipWhitespaces();)if(","==this.chr)e+=",",this.next();else{var n=this.readValueOrValueKeypath();if(n===St)return this.at=t,this.chr=this.content.charAt(t),St;e+=n}return this.next(),e+"]"},readBoolean:function(){Mt.lastIndex=this.at;var t=Mt.exec(this.content)[0];return t?(this.chr=this.content.charAt(this.at+=t.length),t):St},readNumber:function(){Nt.lastIndex=this.at;var t=Nt.exec(this.content)[0];return t?(this.chr=this.content.charAt(this.at+=t.length),t):St},readString:function(){if("'"!=this.chr&&'"'!=this.chr)throw{name:"SyntaxError",message:'Expected "\'" or \'"\' instead of "'+this.chr+'"',at:this.at,content:this.content};for(var t=this.at,e=this.chr,n="";this.next();){if(this.chr==e)return this.next(),e+n+e;if("\\"==this.chr)n+=this.chr+this.next();else{if("\r"==this.chr||"\n"==this.chr)break;n+=this.chr}}return this.at=t,this.chr=this.content.charAt(t),St},readVacuum:function(){jt.lastIndex=this.at;var t=jt.exec(this.content)[0];return t?(this.chr=this.content.charAt(this.at+=t.length),t):St},readValueKeypath:function(){At.lastIndex=this.at;var t=At.exec(this.content)[0];return t?(this.chr=this.content.charAt(this.at+=t.length),_(t)):St},next:function(t){if(t&&t!=this.chr)throw{name:"SyntaxError",message:'Expected "'+t+'" instead of "'+this.chr+'"',at:this.at,content:this.content};return this.chr=this.content.charAt(++this.at)},skipWhitespaces:function(){for(var t=this.chr;t&&t<=" ";)t=this.next();return t}}),Lt=Object.create(null),Ot=Object.create(null),Ht=Object.create(null),kt=/{[^}]+}/,Bt=["click","dblclick","mousedown","mouseup","input","change","submit","focusin","focusout"],Rt=document.createRange(),Ft=void 0;Rt.createContextualFragment?!function(){var t=!1;Ft=function(e){return t||(Rt.selectNode(document.body),t=!0),Rt.createContextualFragment(e)}}():Ft=function(t){var e=document.createElement("div"),n=document.createDocumentFragment();e.innerHTML=t;for(var i;i=e.firstChild;)n.appendChild(i);return n};var Dt=Ft,$t=t.JS.Map,Pt=t.Utils.createClass,Ut=t.EventEmitter.extend({Implements:[F],Static:{register:v,extend:function(t,e){return e.Extends=this,(e.Static||(e.Static={})).elementIs=t,v(Pt(e))},elementIs:void 0,elementExtends:void 0,elementAttributes:null,props:null,i18n:null,template:null,_rawContent:null,_markupBlockNames:null,_assetClassNames:null,events:null},ownerComponent:null,_parentComponent:null,get parentComponent(){if(void 0!==this._parentComponent)return this._parentComponent;for(var t;t=(t||this.element).parentNode;)if(t.$c)return this._parentComponent=t.$c;return this._parentComponent=null},element:null,get elementAttributes(){var t=new ot(this.element);return Object.defineProperty(this,"elementAttributes",{configurable:!0,enumerable:!0,writable:!0,value:t}),t},get props(){var t=Object.create(this.elementAttributes);return t.content=null,t.context=null,Object.defineProperty(this,"props",{configurable:!0,enumerable:!0,writable:!0,value:t}),t},_bindings:null,_assets:null,isElementAttached:!1,initialized:!1,isReady:!1,_isComponentSilent:void 0,constructor:function(e,n){if(t.EventEmitter.call(this),F.call(this),null==e)e=document.createElement(this.constructor.elementIs);else if("string"==typeof e){var i=this.constructor.elementIs,r=e;e=document.createElement(i),e.innerHTML=r;var o=e.firstChild;o==e.lastChild&&1==o.nodeType&&o.tagName.toLowerCase()==i&&(e=o)}if(this.element=e,e.rioniteComponent=this,Object.defineProperty(e,"$c",{value:this}),n){var s=this.props;for(var a in n)s[h(a)]=n[a]}this.created()},_handleEvent:function(e){t.EventEmitter.prototype._handleEvent.call(this,e);var n=this._isComponentSilent;if(void 0===n&&(n=this._isComponentSilent=this.element.hasAttribute("rt-silent")),!n&&e.bubbles!==!1&&!e.isPropagationStopped){var i=this.parentComponent;i?i._handleEvent(e):N(e)}},_attachElement:function(){this.initialized||(this.initialize(),this.initialized=!0);var t=this.constructor,e=t._rawContent,n=this.element;if(this.isReady){if(e)for(var i;i=n.firstChild;)n.removeChild(i)}else{g(n,t),b(this,t);var r=t.template;if(null!=r){e||(e=t._rawContent=Dt("string"==typeof r?r:r.render(t)));for(var o,s=this.props.content=document.createDocumentFragment();o=n.firstChild;)s.appendChild(o)}}if(e){var a=e.cloneNode(!0),l=T(a,this),c=l.bindings,h=l.childComponents;this._bindings=c,this.element.appendChild(a),h&&A(h),M(this,t.events)}this.isReady||(e||M(this,t.events),this.ready(),this.isReady=!0),this.elementAttached()},_detachElement:function(){this.beforeElementDetach(),this.dispose(),this.elementDetached()},dispose:function(){this._destroyBindings(),F.prototype.dispose.call(this)},_destroyBindings:function(){var t=this._bindings;if(t){for(var e=t.length;e;)t[--e].off();this._bindings=null}},created:j,initialize:S,ready:I,elementAttached:L,beforeElementDetach:O,elementDetached:H,elementMoved:k,elementAttributeChanged:B,$:function(t,e){"boolean"==typeof e&&(e={useCache:e});var n=!e||e.useCache!==!1,i=e&&e.all,r=this._assets||(this._assets=new $t),o=n&&r.get(i?t+"*":t);if(!o){var s=e&&e.container,a=this.constructor,l=a._assetClassNames[t],c=s?s instanceof Ut?s.element:s:this.element,h=void 0;if(l)h=c.getElementsByClassName(l);else for(var u=a._markupBlockNames,d=u.length;d;)if(l=u[--d]+"__"+t,h=c.getElementsByClassName(l),h.length){a._assetClassNames[t]=l;break}if(i)return r.set(t+"*",h),h;var f=h[0];o=f?f.$c||f:null,r.set(t,o)}return o},$$:function(t,e){return"boolean"==typeof e&&(e={useCache:e}),yt.call(this.$(t,{__proto__:e,all:!0}),function(t){return t.$c||t})}});document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t),Bt.forEach(function(t){document.addEventListener(t,N)})});var Wt=document.createElement("div");Wt.innerHTML="<template>1</template>";var Gt=Wt.firstChild,Vt=!Gt.firstChild,qt=t.JS.Symbol("Rionite.RtContent#templatesFixed"),zt=Ut.extend("rt-content",{Static:{props:{select:{type:String,readonly:!0},getContext:{type:String,readonly:!0}},template:""},_rawContent:void 0,_attachElement:function(){var t=this.ownerComponent,e=this.element,n=this.props;if(this.isReady)for(var i;i=e.firstChild;)e.removeChild(i);else{for(var r,o=n.content=document.createDocumentFragment();r=e.firstChild;)o.appendChild(r);var s=t.props.content,a=this.elementAttributes.select;if(a){if(!Vt&&!s[qt]){for(var l=s.querySelectorAll("template"),c=l.length;c;)l[--c].content;s[qt]=!0}var h=s.querySelectorAll(a),u=h.length;if(u)for(var d=this._rawContent=document.createDocumentFragment(),f=0;f<u;f++)d.appendChild(h[f].cloneNode(!0));else this._rawContent=o}else this._rawContent=s.firstChild?s:o;this.isReady=!0}var p=this._rawContent.cloneNode(!0),m=n.getContext,v=this._rawContent==n.content?T(p,t,m?t[m](this,n.context):n.context):T(p,t.ownerComponent,m?t[m](this,t.props.context):t.props.context),g=v.bindings,b=v.childComponents;this._bindings=g,e.appendChild(p),b&&A(b)},_detachElement:function(){this._destroyBindings()}}),Kt=t.Utils.nextTick,Jt=Ut.extend("rt-if-then",{Static:{elementExtends:"template",props:{if:{type:String,required:!0,readonly:!0}}},_if:null,_elseMode:!1,_nodes:null,_attachElement:function(){var e=this;this.initialized||!function(){var n=e.props;n.content=document.importNode(e.element.content,!0);var i=new It("{"+n.if+"}").parse();if(i.length>1||i[0].type!=Ct.BINDING)throw new SyntaxError('Invalid value of attribute "if" ('+n.if+")");var r=C(i[0]);e._if=new t.Cell(function(){return!!r.call(this)},{owner:n.context}),e.initialized=!0}(),this._if.on("change",this._onIfChange,this),this._render(!1)},_detachElement:function(){this._destroyBindings(),this._if.off("change",this._onIfChange,this);var t=this._nodes;if(t)for(var e=t.length;e;){var n=t[--e],i=n.parentNode;i&&i.removeChild(n)}},_onIfChange:function(){this._render(!0)},_render:function(t){var e=this;if(this._elseMode?!this._if.get():this._if.get()){var n=this.props.content.cloneNode(!0),i=T(n,this.ownerComponent,this.props.context),r=i.bindings,o=i.childComponents;this._nodes=bt.call(n.childNodes),this._bindings=r,this.element.parentNode.insertBefore(n,this.element.nextSibling),o&&A(o)}else{this._destroyBindings();var s=this._nodes;if(s){for(var a=s.length;a;){var l=s[--a];l.parentNode.removeChild(l)}this._nodes=null}}t&&Kt(function(){e.emit("change")})}}),Xt=Jt.extend("rt-if-else",{Static:{elementExtends:"template"},_elseMode:!0}),Zt=t.JS.Map,Qt=t.Utils.nextTick,Yt=RegExp("^\\s*("+st+")\\s+of\\s+(\\S.*)$"),te='Invalid value of attribute "for"',ee=Ut.extend("rt-repeat",{Static:{elementExtends:"template",props:{for:{type:String,required:!0,readonly:!0},trackBy:{type:String,readonly:!0},strip:{default:!1,readonly:!0}}},_itemName:void 0,_list:null,_itemMap:null,_oldItemMap:null,_trackBy:void 0,_rawItemContent:null,_context:null,_lastNode:null,_attachElement:function(){if(!this.initialized){var e=this.props,n=e.for.match(Yt);if(!n)throw new SyntaxError(te+(" ("+e.for+")"));var i=new It("{"+n[2]+"}").parse();if(i.length>1||i[0].type!=Ct.BINDING)throw new SyntaxError(te+(" ("+e.for+")"));this._itemName=n[1],this._list=new t.Cell(C(i[0]),{owner:e.context}),this._itemMap=new Zt,this._trackBy=e.trackBy;var r=this._rawItemContent=document.importNode(this.element.content,!0);if(e.strip){var o=r.firstChild,s=r.lastChild;o==s?3==o.nodeType&&(o.textContent=o.textContent.trim()):(3==o.nodeType&&((o.textContent=o.textContent.replace(/^\s+/,""))||r.removeChild(o)),3==s.nodeType&&((s.textContent=s.textContent.replace(/\s+$/,""))||r.removeChild(s)))}this._context=e.context,this.initialized=!0}this._list.on("change",this._onListChange,this),this._render(!1)},_detachElement:function(){this._clearWithItemMap(this._itemMap),this._list.off("change",this._onListChange,this)},_onListChange:function(){this._render(!0)},_render:function(t){var e=this,n=this._oldItemMap=this._itemMap;this._itemMap=new Zt;var i=this._list.get(),r=!1;if(i&&(this._lastNode=this.element,r=i.reduce(function(t,n,i){return e._renderItem(n,i)||t},r)),n.size)this._clearWithItemMap(n);else if(!r)return;t&&Qt(function(){e.emit("change")})},_renderItem:function(e,n){var i,r=this._trackBy,o=r?"$index"==r?n:e[r]:e,s=this._oldItemMap.get(o),a=this._itemMap.get(o);if(s){var l=void 0;1==s.length?(l=s[0],this._oldItemMap.delete(o)):l=s.shift(),a?a.push(l):this._itemMap.set(o,[l]),l.item.set(e);var c=l.nodes;if(n==l.index.get())return this._lastNode=c[c.length-1],!1;if(l.index.set(n),1==c.length){var h=c[0];this._lastNode.parentNode.insertBefore(h,this._lastNode.nextSibling),this._lastNode=h}else{for(var u=document.createDocumentFragment(),d=0,f=c.length;d<f;d++)u.appendChild(c[d]);var p=u.lastChild;this._lastNode.parentNode.insertBefore(u,this._lastNode.nextSibling),this._lastNode=p}return!0}e=new t.Cell(e),n=new t.Cell(n);var m=this._rawItemContent.cloneNode(!0),v=Object.create(this._context,(i={},i[this._itemName]={get:function(){return e.get()}},i.$index={get:function(){return n.get()}},i)),g=T(m,this.ownerComponent,v),b=g.bindings,_=g.childComponents,y={item:e,index:n,nodes:bt.call(m.childNodes),bindings:b};a?a.push(y):this._itemMap.set(o,[y]);var w=m.lastChild;return this._lastNode.parentNode.insertBefore(m,this._lastNode.nextSibling),this._lastNode=w,_&&A(_),!0},_clearWithItemMap:function(t){t.forEach(this._clearWithItems,this),t.clear()},_clearWithItems:function(t){for(var e=t.length;e;){var n=t[--e],i=n.bindings;if(i)for(var r=i.length;r;)i[--r].off();for(var o=n.nodes,s=o.length;s;){var a=o[--s],l=a.parentNode;l&&l.removeChild(a)}}}}),ne={DisposableMixin:F,formatters:G,getText:e,ElementAttributes:ot,ComponentTemplate:f,Component:Ut,Components:{RtContent:zt,RtIfThen:Jt,RtIfElse:Xt,RtRepeat:ee},Utils:{camelize:h,hyphenize:u,escapeString:d,escapeHTML:a,unescapeHTML:l,isRegExp:c,defer:m,htmlToFragment:Dt}};return ne.Rionite=ne,ne});